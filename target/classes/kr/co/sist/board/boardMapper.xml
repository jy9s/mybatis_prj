<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.sist.board">
	<!-- board 테이블에 추가하는 쿼리 -->
	<insert id="insertBoard" parameterType="kr.co.sist.board.BoardDTO">
		insert into board(num, title, content, ip, id)
		values(seq_board.nextval, #{title}, #{content}, #{ip}, #{id})
	</insert>

	<update id="updateBoardCnt" parameterType="int">
		update board 
		set cnt = cnt + 1	
		where num = #{num}	
	</update>
	<!-- 글번호와 아이디를 입력받아서 해당 글에 내용과 ip를 변경 -->
	<update id="updateBoard" parameterType="boardDomain">
		update	board	
		set		content=#{content}, ip=#{ip}	
		where	num=#{num} and id=#{id}
		
			
	</update>

	<select id = "selectBoardTotalCnt" parameterType="rangeDTO" resultType="int">
		select count(*) cnt from board
		<if test="keyword neq null and keyword neq ''">
		<where>
			instr( ${fieldStr} , #{keyword} ) ! = 0 
		</where>		
		</if>		
	</select>
	
	<select id = "selectRangeBoard" parameterType="rangeDTO" resultType="boardDomain">
		select num,title, input_date, cnt, id from
		(select num, title, input_date, ip, cnt, id, row_number() over(order by input_date desc) rnum  from board 
		<if test="keyword neq null and keyword neq ''">
		<where>
			instr(fieldStr , #{keyword} ) ! = 0 
		</where>		
		</if>				
		)where rnum between #{startNum} and #{endNum}
		
	</select>
	
	<select id = "selectBoardDetail" parameterType="int" resultType="boardDomain">
		select title, content, input_date, cnt, id 
		from board	
		where num = #{num}
	</select>

	<delete id="deleteBoard" parameterType="boardDomain">
		delete from	board
		where	num=#{num} and id =#{id}
	</delete>

</mapper>